<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Beställningsformulär SG-systemet 2010</title>

<link rel="stylesheet" type="text/css" href="SwecoLibrary/ext-all.css" />
<link rel="stylesheet" type="text/css" href="SwecoLibrary/SG.css" />

    <!-- GC -->
 	<!-- LIBS -->
 	<script type="text/javascript" src="SwecoLibrary/ext-base.js"></script>
 	<!-- ENDLIBS -->

    <script type="text/javascript" src="SwecoLibrary/ext-all.js"></script>

    <script type="text/javascript" src="SwecoLibrary/GroupingView.js"></script>
	
    <script type="text/javascript" src="SwecoLibrary/edit-grid.js"></script>
	<link rel="stylesheet" type="text/css" href="SwecoLibrary/grid-examples.css" />
	
	<script type="text/javascript" src="SwecoLibrary/edit-grid-start.js"></script>
    <link rel="stylesheet" type="text/css" href="SwecoLibrary/grid-examples.css" />
	
	<script type="text/javascript" src="SwecoLibrary/edit-grid-reserv.js"></script>
    <link rel="stylesheet" type="text/css" href="SwecoLibrary/grid-examples.css" />

<!-- Common Styles for the examples -->
<link rel="stylesheet" type="text/css" href="SwecoLibrary/examples.css" />
</head>
<body>

	<!-- Bygger upp XML-strängen -->
	<script type="text/javascript">
		
		// Kontrollerar och bygger sedan upp xml-en som skickas via mail sist i denna funktion. 
		function ByggUppXML(thisForm)
		{
			// Kontrollerar formuläret. 
			if (!KontrolleraFormular(thisForm))
			{
				return;
			}
			var xml = "";

			xml += "<Best&aumlllning>";
			xml += "\n\t<F&oumlretag>";
			
			var date = new Date();
			// Lägger till dagens datum
			xml += "\n\t\t<Best&aumlllningsdatum>" + date.getFullYear() + "-";
			
			// Lägger till en nolla om måndaden är under 10 så vi får 01 och inte 1. 
			if ((date.getMonth() + 1) < 10)	
				xml += "0";
			xml += (date.getMonth() + 1) + "-";
			
			// Lägger till en nolla om dagen är under 10 så vi får 01 och inte 1. 
			if (date.getDate() < 10)
				xml += "0";
            xml += date.getDate() + "</Best&aumlllningsdatum>";

			xml += "\n\t\t<F&oumlretagsnamn>" + FixaTillTecken(formular.Foretag.value) + "</F&oumlretagsnamn>";
			xml += "\n\t\t<Faktureringsadress>" + FixaTillTecken(formular.FAdress.value) + "</Faktureringsadress>";
			xml += "\n\t\t<Postnummer>" + FixaTillTecken(formular.FPostnummer.value) + "</Postnummer>";
			xml += "\n\t\t<Ort>" + FixaTillTecken(formular.FOrt.value) + "</Ort>";
			xml += "\n\t\t<Region_F&oumlrvaltning>" + FixaTillTecken(formular.Region.value) + "</Region_F&oumlrvaltning>";
			xml += "\n\t\t<L&aumln>" + FixaTillTecken(formular.Lan.value) + "</L&aumln>";
			xml += "\n\t\t<Distrikt_Omr&aringde>" + FixaTillTecken(formular.Distrikt.value) + "</Distrikt_Omr&aringde>";
			xml += "\n\t\t<Best&aumlllningsreferens>" + FixaTillTecken(formular.Bestallningsreferens.value) + "</Best&aumlllningsreferens>";
			
			xml += "\n\t\t<Kontaktperson1>" + FixaTillTecken(formular.Namn1.value) + "</Kontaktperson1>";
			xml += "\n\t\t<Telefon_Arb1>" + FixaTillTecken(formular.TfnArb1.value) + "</Telefon_Arb1>";
			xml += "\n\t\t<Telefon_Mob1>" + FixaTillTecken(formular.TfnMob1.value) + "</Telefon_Mob1>";
			xml += "\n\t\t<Telefon_Hem1>" + FixaTillTecken(formular.TfnHem1.value) + "</Telefon_Hem1>";
			xml += "\n\t\t<E-postadress1>" + FixaTillTecken(formular.Epost1.value) + "</E-postadress1>";
			
			xml += "\n\t\t<Kontaktperson2>" + FixaTillTecken(formular.Namn2.value) + "</Kontaktperson2>";
			xml += "\n\t\t<Telefon_Arb2>" + FixaTillTecken(formular.TfnArb2.value) + "</Telefon_Arb2>";
			xml += "\n\t\t<Telefon_Mob2>" + FixaTillTecken(formular.TfnMob2.value) + "</Telefon_Mob2>";
			xml += "\n\t\t<Telefon_Hem2>" + FixaTillTecken(formular.TfnHem2.value) + "</Telefon_Hem2>";
			xml += "\n\t\t<E-postadress2>" + FixaTillTecken(formular.Epost2.value) + "</E-postadress2>";
			xml += "\n\t</F&oumlretag>";
			
			xml += StartHämtaXML();
			
			xml += "\n\t<Kommentar>" + FixaTillTecken(formular.upplysningar.value) + "</Kommentar>";

			xml += "\n</Best&aumlllning>";
						
			// Hämtar den lättlästa texten. 
			var text = ByggUppText(thisForm);
			text = FixaTillTecken(text);
			
			// Skickar iväg xmlen till php-sidan som i sin tur skickar iväg ett mail.
			Ext.Ajax.request(
			{
				url: 'http://www.sg-systemet.com/Bestallningsformular.php',
				success : function (resultSuccess, requestFailure) { EpostSkickat(); },
				failure : function (resultSuccess, requestFailure) { EpostInteSkickat(); },
				params: {xml : xml, text : text, ton : formular.summaCAN.value, foretag : FixaTillTecken(formular.Foretag.value), kontakt1 : FixaTillTecken(formular.Epost1.value)}
			});
		}
		
		function ByggUppText(thisForm)
		{
			// Bygger upp beställningstexten. 
			var text = "";
			text += "Beställningsdatum: ";
			
			var date = new Date();
			// Lägger till dagens datum
			text += date.getFullYear() + "-";
			
			// Lägger till en nolla om måndaden är under 10 så vi får 01 och inte 1.  Notera att januari har nummer 0 och inte 1 därför date.getMonth() + 1. 
			if ((date.getMonth() + 1) < 10)	
				text += "0";
			text += (date.getMonth() + 1) + "-";
			
			// Lägger till en nolla om dagen är under 10 så vi får 01 och inte 1. 
			if (date.getDate() < 10)
				text += "0";
			text += date.getDate();
			
			// Lägger till Företagsnamn m.m.
			text += "\nFöretagsnamn: " + formular.Foretag.value;
			text += "\nFaktureringsadress: " + formular.FAdress.value;
			text += "\nPostnummer: " + formular.FPostnummer.value;
			text += "\nOrt: " + formular.FOrt.value;
			text += "\nRegion/Förvaltning :" + formular.Region.value;
			text += "\nLän :" + formular.Lan.value;

			text += "\nDistrikt/Område :" + formular.Distrikt.value;
			text += "\nBeställningsreferens :" + formular.Bestallningsreferens.value;
			text += "\nKontaktperson1 :" + formular.Namn1.value;
			text += "\nTelefon Arb1 :" + formular.TfnArb1.value;
			text += "\nTelefon Mob1 :" + formular.TfnMob1.value;
			text += "\nTelefon Hem1 :" + formular.TfnHem1.value;
			text += "\nE-postadress1 :" + formular.Epost1.value;
			text += "\nKontaktperson2 :" + formular.Namn2.value;
			text += "\nTelefon Arb2 :" + formular.TfnArb2.value;
			text += "\nTelefon Mob2 :" + formular.TfnMob2.value;
			text += "\nTelefon Hem2 :" + formular.TfnHem2.value;
			text += "\nE-postadress2 :" + formular.Epost2.value;
			
			text += "\n\n" + StartHämtaText();
			text += "\n\nKommentar: " + formular.upplysningar.value;
			
			return text;
		}
		
		// Om beställningse-posten har skickats till SG så skall kontaktpersonerna också få ett mail. 
		function EpostSkickat()
		{
			alert('Beställningen har skickats till Skogens Gödsling. Du får snart ett mail som visar dina beställningsuppgifter.');
		}
		
		// Om beställningse-posten inte har skickats till SG så skall detta meddelas till användaren. 
		function EpostInteSkickat()
		{
			alert('Beställningen har inte kommit fram till Skogens Gödsling. Vänligen gör ett nytt försök eller hör av dig till Skogens Gödsling. ');
		}
		
		// Byter ut alla å, ä och ö till html-tecken så att tecken inte visas fel i vissa e-postprogram. 
		function FixaTillTecken(text)
		{
			var ans = "";
			
			if (text == null)
				return null;
		
			// Ersätter varje å, ä och ö med html-motsvarigheten. 
			for (var i = 0; i < text.length; i++)
			{
				var bokstav = text.charAt(i);
				
				if (bokstav == 'å')
				{
					ans += "&aring";
				}
				else if (bokstav == 'Å')
				{
					ans += "&Aring";
				}
				else if (bokstav == 'ä')
				{
					ans += "&auml";
				}
				else if (bokstav == 'Ä')
				{
					ans += "&Auml";
				}
				else if (bokstav == 'ö')
				{
					ans += "&ouml";
				}
				else if (bokstav == 'Ö')
				{
					ans += "&Ouml";
				}
				else if (bokstav == 'ü')
				{
					ans += "&uuml";
				}
				else if (bokstav == 'Ü')
				{
					ans += "&Uuml";
				}
				else if (bokstav == 'û')
				{
					ans += "&ucirc";
				}
				else if (bokstav == 'Û')
				{
					ans += "&Ucirc";
				}
				else if (bokstav == 'é')
				{
					ans += "&egrave";
				}
				else if (bokstav == 'É')
				{
					ans += "&Egrave";
				}
				else if (bokstav == 'è')
				{
					ans += "&eacute";
				}
				else if (bokstav == 'È')
				{
					ans += "&Eacute";
				}
				else if (bokstav == '&')
				{
					ans += "&amp";
				}
				else if (bokstav == '<')
				{
					ans += "&lt";
				}
				else if (bokstav == '>')
				{
					ans += "&gt";
				}
				else if (bokstav == '"')
				{
					ans += "&quot";
				}
				else if (bokstav == "'")
				{
					ans += "&#39";
				}
				else
				{
					ans += bokstav;
				}
			}
			
			return ans;
		}
		
		// Kontrollerar så att alla uppgifter som måste vara ifyllda är ifyllda. 
		function KontrolleraFormular(thisForm)
		{
			var FormularOk = true;
			var Felmeddelande = "";
		
			// Kontrollerar Företag
			if (formular.Foretag.value == '')
			{
				if (!FormularOk)
				{
					Felmeddelande += '\n';
				}
				Felmeddelande += 'Måste fylla i företag. ';
				FormularOk = false;
			}
			
			// Kontrollerar Postnummer
			if (formular.FPostnummer.value == '')
			{
				if (!FormularOk)
				{
					Felmeddelande += '\n';
				}
				Felmeddelande += 'Måste fylla i företagets postnummer. ';
				FormularOk = false;
			}
			
			// Kontrollerar Ort
			if (formular.FOrt.value == '')
			{
				if (!FormularOk)
				{
					Felmeddelande += '\n';
				}
				Felmeddelande += 'Måste fylla i företagets ort. ';
				FormularOk = false;
			}
			
			// Kontrollerar Kontaktperson1 namn
			if (formular.Namn1.value == '')
			{
				if (!FormularOk)
				{
					Felmeddelande += '\n';
				}
				Felmeddelande += 'Måste fylla i kontaktperson 1:s namn. ';
				FormularOk = false;
			}
			
			// Kontrollerar Kontaktperson1 telefon arbetet
			if (formular.TfnArb1.value == '')
			{
				if (!FormularOk)
				{
					Felmeddelande += '\n';
				}
				Felmeddelande += 'Måste fylla i kontaktperson 1:s telefon till arbetet. ';
				FormularOk = false;
			}
			
			// Kontrollerar Kontaktperson1 telefon mobil
			if (formular.TfnMob1.value == '')
			{
				if (!FormularOk)
				{
					Felmeddelande += '\n';
				}
				Felmeddelande += 'Måste fylla i kontaktperson 1:s mobilnummer. ';
				FormularOk = false;
			}
			
			// Kontrollerar Kontaktperson1 epost
			if (!InnehållerTecken(formular.Epost1.value, '@.'))
			{
				if (!FormularOk)
				{
					Felmeddelande += '\n';
				}
				Felmeddelande += 'Måste fylla i kontaktperson 1:s e-postadress. ';
				FormularOk = false;
			}
			
			// Kontrollerar så att alla obligatoriska celler i översta gridden är ifyllda.
			var tmpFelmeddelande = KorrektIFylld();
			if (tmpFelmeddelande != "")
			{
				if (!FormularOk)
				{
					Felmeddelande += '\n';
				}
				Felmeddelande += tmpFelmeddelande;
				FormularOk = false;
			}
			
			// Kontrollerar så att alla obligatoriska celler i mellersta gridden är ifyllda.
			tmpFelmeddelande = StartKorrektIFylld();
			if (tmpFelmeddelande != "")
			{
				if (!FormularOk)
				{
					Felmeddelande += '\n';
				}
				Felmeddelande += tmpFelmeddelande;
				FormularOk = false;
			}
			
			// Kontrollerar så att alla obligatoriska celler i nedersta gridden är ifyllda.
			tmpFelmeddelande = RKorrektIFylld();
			if (tmpFelmeddelande != "")
			{
				if (!FormularOk)
				{
					Felmeddelande += '\n';
				}
				Felmeddelande += tmpFelmeddelande;
				FormularOk = false;
			}
			
			// Kontrollerar så att kryssrutan är ikryssad
			if (!formular.skickaKartfiler.checked)
			{
				if (!FormularOk)
				{
					Felmeddelande += '\n';
				}
				Felmeddelande += 'Måste kryssa i rutan om inskickande av kartfiler. ';
				FormularOk = false;
			}
			
			// kollar att inga kommentarer är längre än 30 tecken. 
			var errors = KollaKommentarer();
			if (errors.length > 0)
			{
				if (!FormularOk)
				{
					Felmeddelande += '\n';
				}
				
				for (var i = 0; i < errors.length; i++)
				{
					Felmeddelande += 'Kommentaren för rad ' + errors[i] + ' för gridden "Objekt att gödsla" är längre än 30 tecken. ';
				}
				FormularOk = false;
			}
			
			// Kollar att inga kommentarer är längre än 30 tecken. 
			var Rerrors = RKollaKommentarer();
			if (Rerrors.length > 0)
			{
				if (!FormularOk)
				{
					Felmeddelande += '\n';
				}
				
				for (var i = 0; i < Rerrors.length; i++)
				{
					Felmeddelande += 'Kommentaren för rad ' + Rerrors[i] + ' för gridden "Reservobjekt att eventuellt gödsla" är längre än 30 tecken. "';
				}
				FormularOk = false;
			}
			
			// Om några fel hittat skall de rapporteras, d.v.s skrivas ut på skärmen i en ruta. 
			if (!FormularOk)
			{
				alert("Följande fel finns i formuläret: \n" + Felmeddelande);
			}
			
			return FormularOk;
		}

		// Kontrollerar om texten innehåller de tecken som är med. Om någon sträng är tom returneras false. 
		function InnehållerTecken(Text, Tecken)
		{
			var innehållerTecken = true;
			
			// Kollar basfall
			if (Text.length == 0)
				return false;
			if (Tecken.length == 0)
				return false;
			
			// Går igenom alla tecken och kollar att de finns med itexten
			for (var teckenNummer = 0; teckenNummer < Tecken.length && innehållerTecken; teckenNummer++)
			{
				innehållerTecken = false;
				for (var textTeckenNummer = 0; textTeckenNummer < Text.length; textTeckenNummer++)
				{
					if (Text.charAt(textTeckenNummer) == Tecken.charAt(teckenNummer))
					{
						innehållerTecken = true;
						break;
					}
				}
			}
			
			return innehållerTecken;
		}
	</script>

<form name="formular" action="*">

<font size="4" face="Verdana"><b> Beställningsformulär SG-systemet 2010</b></font><br>
	<br>
	
	<input type="button" value="Hjälp" onclick="window.open('http://www.sg-systemet.com/Bestallningsformularshjalp.html', '', 'scrollbars=1,resizable=1,width=800,height=600');"/>
	
	<br>
	<br>
	
	<STYLE TYPE="text/css">
		TD{font-family: Arial; font-size: 10pt;}
	</STYLE>
	
	<table>
		<tr>
			<td>
				*Företag: 
			</td>
			<td>
				<input type="text" size="30" name="Foretag">
			</td>
			<td width="40">
			</td>
			<td>
				Län:
			</td>
			<td>
				<input type="text" size="30" name="Lan">
			</td>
		</tr>
		<tr>
			<td>
				Faktureringsadress: 
			</td>
			<td>
				<input type="text" size="30" name="FAdress">
			</td>
			<td width="40">
			</td>
			<td>
				Region/Förvaltning el. dyl:
			</td>
			<td>
				<input type="text" size="30" name="Region">
			</td>
		</tr>
		<tr>
			<td>
				*Postnummer: 
			</td>
			<td>
				<input type="text" size="3" maxlength="6" name="FPostnummer">
			</td>
			<td width="40">
			</td>
			<td>
				Distrikt/Område el. dyl:
			</td>
			<td>
				<input type="text" size="30" name="Distrikt">
			</td>
		</tr>
		<tr>
			<td>
				*Ort:
			</td>
			<td>
				<input type="text" size="30" name="FOrt">
			</td>
			<td width="40">
			</td>
			<td>
				Beställningsreferens:
			</td>
			<td>
				<input type="text" size="30" name="Bestallningsreferens">
			</td>
		</tr>
		<tr>
		</tr>
		<tr>
		</tr>
		<tr>
		</tr>
		<tr>
		</tr>
		<tr>
		</tr>
		<tr>
			<td>
				<font size="2" face="Verdana"><b> Kontaktperson ett </b></font>
			</td>
			<td>
			</td>
			<td width="40">
			</td>
			<td>
				<font size="2" face="Verdana"><b> Kontaktperson två </b></font>
			</td>
			<td>
			</td>
			<td>
		</tr>
		<tr>
			<td>
				*Namn: 
			</td>
			<td>
				<input type="text" size="30" name="Namn1">
			</td>
			<td width="40">
			</td>
			<td>
				Namn: 
			</td>
			<td>
				<input type="text" size="30" name="Namn2">
			</td>
		</tr>
		<tr>
			<td>
				*Telefon arb:
			</td>
			<td>
				<input type="text" size="20" name="TfnArb1">
			</td>
			<td width="40">
			</td>
			<td>
				Telefon arb:
			</td>
			<td>
				<input type="text" size="20" name="TfnArb2">
			</td>
		</tr>
		<tr>
			<td>
				*Telefon mob:
			</td>
			<td>
				<input type="text" size="20" name="TfnMob1">
			</td>
			<td width="40">
			</td>
			<td>
				Telefon mob:
			</td>
			<td>
				<input type="text" size="20" name="TfnMob2">
			</td>
		</tr>
		<tr>
			<td>
				Telefon hem:
			</td>
			<td>
				<input type="text" size="20" name="TfnHem1">
			</td>
			<td width="40">
			</td>
			<td>
				Telefon hem:
			</td>
			<td>
				<input type="text" size="20" name="TfnHem2">
			</td>
		</tr>
		<tr>
			<td>
				*E-postadress:
			</td>
			<td>
				<input type="text" size="30" name="Epost1">
			</td>
			<td width="40">
			</td>
			<td>
				E-postadress:
			</td>
			<td>
				<input type="text" size="30" name="Epost2">
			</td>
		</tr>
	</table>

	<br>
	<br>
	
	<!-- Gridden som man beställer med.  --> 
	<script type="text/javascript" src="SwecoLibrary/examples.js"></script>
	<div onmouselick id="editor-grid"></div>
	
	<font size="1">Koord N måste ligga inom intervallet 6130000-7680000</font><br>
    <font size="1">Koord Ö måste ligga inom intervallet 1220000-1880000</font>
	<br>
	
	<!-- Gridden som man beställer med.  --> 
	<script type="text/javascript" src="SwecoLibrary/examples.js"></script>
	<!--<div id="grid-example"></div> -->
	<div onmouselick id="editor-grid3"></div>
	
	<br>
	
	<!-- Fälten med summa areal, summa can och räkna om knappen --> 
	Summa Areal (ha): <input type="text" name="summaAreal" align="right" disabled="disabled" size="10">
	Summa Skog-CAN (ton): <input type="text" name="summaCAN" align="right" disabled="disabled" size="10">

	<br>
	<br>
	<br>
	
	<!-- Gridden som man beställer med.  --> 
	<script type="text/javascript" src="SwecoLibrary/examples.js"></script>
	<div onmouseklick id="editor-grid2"></div>
	
	<br>
	
	<!-- Fälten med summa areal, summa can och räkna om knappen --> 
	Summa Reservareal (ha): <input type="text" name="RsummaAreal" align="right" disabled="disabled" size="10">
	
	<br>
	<br>
	<br>
	<br>
	
	<font size="2" face="Verdana"><b> Övriga upplysningar </b></font>
	<br>
	<br>
	<textarea rows="5" cols="50" name="upplysningar"></textarea>
	
	<br>
	<br>
	
	<!-- Kryssrytan som anger att kartfiler skall skickas.-->
	<input type="checkbox" name="skickaKartfiler">Jag kommer att skicka kartfiler i direkt anslutning till min beställning.<p>
	
	<br>
	<br>
	
	<input type="button" value="Skicka" onclick="ByggUppXML(this)" /> 
	När beställningen är skickad får du ett bekräftelsemail som du kan skriva ut, som din kopia av beställningen. 
	<br>
	&nbsp;<p>
	
	<b>Observera</b> att det kan 
	hända att bekräftelsemailet fastnar i sk skräppostfilter, för att undvika 
	detta kan man lägga till cbLomWYI@cvh-fe01.carambole.com som betrodd 
	avsändare i e-postprogrammet.<p>
	
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</body>
</html>